<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>호감도</title>
    <meta content="website" property="og:type" th:content="'website'">
    <meta content="치즈냥" property="og:site_name" th:content="'치즈냥'">
    <meta content="호감도" property="og:title" th:content="'호감도'">
    <meta content="최근 변경된 내역을 확인하고, 원하는 항목만 빠르게 찾아보세요." property="og:description"
          th:content="'최근 변경된 내역을 확인하고, 원하는 항목만 빠르게 찾아보세요.'">
    <meta content="/assets/index.png" property="og:image" th:content="@{/assets/index.png}">
    <meta content="summary" name="twitter:card" th:content="'summary'">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
          rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/favorite-list.css" rel="stylesheet" th:href="@{/css/favorite-list.css}">
    <link href="https://nng-phinf.pstatic.net/MjAyNDAzMDlfMjQg/MDAxNzA5OTI3ODk5MTk4.-R_7VTIWynEx4CSWpUvSgqWIGlylkkv-hv8JsHugcvQg.d3Vl9GN584w3__Lxbaq5zWYBBhugPJ-CIZHl6KoZ1-8g.PNG/%ED%95%98%ED%8A%B8%EC%86%90_%EC%95%8C%ED%8A%B8%EB%B8%8C%EC%9D%B4.png?type=f120_120_na"
          rel="icon">
</head>
<body>
<div class="page">
    <header class="hero">
        <div class="hero-title">
            <span class="badge" th:text="${currentNickName != null ? currentNickName : '치즈냥'}">치즈냥</span>
            <h1>호감도</h1>
            <p>최근 변경된 내역을 확인하고, 원하는 항목만 빠르게 찾아보세요.</p>
        </div>
        <div class="hero-actions">
            <button class="btn-ghost btn-attendance btn-auth" id="attendance-button" type="button">출석체크</button>
        </div>
    </header>

    <div class="alert" th:if="${errorMessage}" th:text="${errorMessage}"></div>

    <section class="controls">
        <section class="ticker-shell">
            <div class="ticker-header">
                <span class="ticker-title">주간 후원 랭킹</span>
                <span class="ticker-subtitle">Top Supporters</span>
            </div>
            <div class="ticker-viewport">
                <div class="ticker-track" th:if="${donationRanks != null and !#lists.isEmpty(donationRanks)}">
                    <div class="ticker-row">
                        <span class="rank-badge" th:each="rank : ${donationRanks}">
                            <span class="rank-emoji" th:switch="${rank.rank}">
                                <span th:case="1">🥇</span>
                                <span th:case="2">🥈</span>
                                <span th:case="3">🥉</span>
                                <span th:case="*"></span>
                            </span>
                            <span th:text="${rank.rank} + '위 ' + ${rank.nickname}">1위 치즈냥</span>
                        </span>
                    </div>
                    <div aria-hidden="true" class="ticker-row">
                        <span class="rank-badge" th:each="rank : ${donationRanks}">
                            <span class="rank-emoji" th:switch="${rank.rank}">
                                <span th:case="1">🥇</span>
                                <span th:case="2">🥈</span>
                                <span th:case="3">🥉</span>
                                <span th:case="*"></span>
                            </span>
                            <span th:text="${rank.rank} + '위 ' + ${rank.nickname}">1위 치즈냥</span>
                        </span>
                    </div>
                </div>
                <div class="ticker-empty" th:if="${donationRanks == null or #lists.isEmpty(donationRanks)}">
                    이번 주 후원 기록 없음
                </div>
            </div>
        </section>

        <form class="search-form" method="get" th:action="@{/favorite/list}">
            <div class="search-field">
                <span>닉네임</span>
                <input id="nickName" name="nickName" placeholder="Enter nickName" th:value="${nickName}" type="text">
            </div>
            <div class="d-flex flex-column flex-sm-row gap-2 search-actions">
                <button class="btn-strong" type="submit">Search</button>
                <button class="btn-ghost btn-auth" id="sync-button" type="button">데이터 동기화</button>
            </div>
        </form>
    </section>

    <section class="board">
        <div class="board-head">
            <div>닉네임</div>
            <div>호감도</div>
            <div>호감도 수정</div>
        </div>
        <div class="board-body" th:if="${favoriteList != null}">
            <div class="board-row" th:data-favorite="${favoriteEntity.favorite}"
                 th:data-nick-name="${favoriteEntity.nickName}"
                 th:data-user-id="${favoriteEntity.userId}"
                 th:each="favoriteEntity, iterStat : ${favoriteList.content}"
                 th:style="'--i:' + ${iterStat.index}">
                <div>
                    <div class="nickname-line">
                        <div class="nickname" th:data-user-id="${favoriteEntity.userId}"
                             th:text="${favoriteEntity.nickName}">테스트
                        </div>
                    </div>
                </div>
                <div>
                    <span class="score" th:text="${favoriteEntity.favorite}">12200</span>
                </div>
                <div>
                    <button class="karma-button btn-auth" type="button">호감도 수정</button>
                </div>
                <div class="history-details">
                    <div class="history-grid"></div>
                </div>
            </div>
        </div>
    </section>

    <div th:if="${favoriteList != null}">
        <nav th:if="${favoriteList.totalPages > 1}"
             th:with="blockSize=${10}, start=${(favoriteList.number / blockSize) * blockSize},
                  end=${T(java.lang.Math).min(favoriteList.totalPages - 1, start + blockSize - 1)}">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${favoriteList.number == 0} ? 'disabled'">
                    <a aria-label="Previous" class="page-link"
                       th:href="@{/favorite/list(page=${favoriteList.number - 1})}">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>

                <li class="page-item" th:if="${start > 0}">
                    <a class="page-link" th:href="@{/favorite/list(page=0)}">1</a>
                </li>
                <li class="page-item disabled" th:if="${start > 1}">
                    <span class="page-link">...</span>
                </li>

                <li class="page-item"
                    th:classappend="${i == favoriteList.number} ? 'active'"
                    th:each="i : ${#numbers.sequence(start, end)}">
                    <a class="page-link" th:href="@{/favorite/list(page=${i})}" th:text="${i + 1}"></a>
                </li>

                <li class="page-item disabled" th:if="${end < favoriteList.totalPages - 2}">
                    <span class="page-link">...</span>
                </li>
                <li class="page-item" th:if="${end < favoriteList.totalPages - 1}">
                    <a class="page-link" th:href="@{/favorite/list(page=${favoriteList.totalPages - 1})}"
                       th:text="${favoriteList.totalPages}"></a>
                </li>

                <li class="page-item"
                    th:classappend="${favoriteList.number == favoriteList.totalPages - 1} ? 'disabled'">
                    <a aria-label="Next" class="page-link" th:href="@{/favorite/list(page=${favoriteList.number + 1})}">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<div th:replace="~{fragments/toast :: toast}"></div>
<div th:replace="~{fragments/karma-modal :: karma-modal}"></div>
<div th:replace="~{fragments/attendance-modal :: attendance-modal}"></div>
<div th:replace="~{fragments/loading :: loading}"></div>

<script th:inline="javascript">
    window.baseUrl = [[@{/}]];
</script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="/js/favorite-list.js" th:src="@{/js/favorite-list.js}"></script>
</body>
</html>
