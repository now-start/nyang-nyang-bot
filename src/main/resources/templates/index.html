<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>호감도</title>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
          rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/favorite-list.css" rel="stylesheet">
    <link href="https://nng-phinf.pstatic.net/MjAyNDAzMDlfMjQg/MDAxNzA5OTI3ODk5MTk4.-R_7VTIWynEx4CSWpUvSgqWIGlylkkv-hv8JsHugcvQg.d3Vl9GN584w3__Lxbaq5zWYBBhugPJ-CIZHl6KoZ1-8g.PNG/%ED%95%98%ED%8A%B8%EC%86%90_%EC%95%8C%ED%8A%B8%EB%B8%8C%EC%9D%B4.png?type=f120_120_na"
          rel="icon">
</head>
<body>
<div class="page">
    <header class="hero">
        <div class="hero-title">
            <span class="badge">치즈냥</span>
            <h1>호감도</h1>
            <p>최근 변경된 내역을 확인하고, 원하는 항목만 빠르게 찾아보세요.</p>
        </div>
        <div class="hero-actions">
            <button class="btn-ghost btn-attendance" id="attendance-button" type="button">출석체크</button>
        </div>
    </header>

    <div class="alert" th:if="${errorMessage}" th:text="${errorMessage}"></div>

    <section class="controls">
        <form class="search-form" method="get" th:action="@{/favorite/list}">
            <div class="search-field">
                <span>닉네임</span>
                <input id="nickName" name="nickName" placeholder="Enter nickName" th:value="${nickName}" type="text">
            </div>
            <div class="d-flex flex-column flex-sm-row gap-2">
                <button class="btn-strong" type="submit">Search</button>
                <button class="btn-ghost" id="sync-button" type="button">데이터 동기화</button>
            </div>
        </form>
    </section>

    <section class="board">
        <div class="board-head">
            <div>닉네임</div>
            <div>호감도</div>
            <div>사유</div>
            <div>일자</div>
        </div>
        <div class="board-body" th:if="${favoriteList != null}">
            <div class="board-row" th:data-favorite="${favoriteEntity.favorite}"
                 th:data-nick-name="${favoriteEntity.nickName}"
                 th:data-user-id="${favoriteEntity.userId}"
                 th:each="favoriteEntity, iterStat : ${favoriteList.content}"
                 th:style="'--i:' + ${iterStat.index}">
                <div>
                    <div class="nickname-line">
                        <div class="nickname" th:data-user-id="${favoriteEntity.userId}"
                             th:text="${favoriteEntity.nickName}">테스트
                        </div>
                        <button class="karma-button" type="button">업보</button>
                    </div>
                </div>
                <div>
                    <span class="score" th:text="${favoriteEntity.favorite}">12200</span>
                    <div class="history-details">
                        <ul th:each="favoriteHistoryEntityList, iterStat : ${favoriteEntity.favoriteHistoryEntityList}"
                            th:if="${iterStat.index} < 5">
                            <li th:text="${favoriteHistoryEntityList.favorite}">12200</li>
                        </ul>
                    </div>
                </div>
                <div>
          <span th:if="${!#lists.isEmpty(favoriteEntity.favoriteHistoryEntityList)}"
                th:text="${favoriteEntity.favoriteHistoryEntityList[0].history}">최초 입력</span>
                    <span th:if="${#lists.isEmpty(favoriteEntity.favoriteHistoryEntityList)}">-</span>
                    <div class="history-details">
                        <ul th:each="favoriteHistoryEntityList, iterStat : ${favoriteEntity.favoriteHistoryEntityList}"
                            th:if="${iterStat.index} < 5">
                            <li th:text="${favoriteHistoryEntityList.history}">최초 입력</li>
                        </ul>
                    </div>
                </div>
                <div>
          <span th:if="${favoriteEntity.modifyDate != null}"
                th:text="${#temporals.format(favoriteEntity.modifyDate, 'M/d')}">10/08</span>
                    <span th:if="${favoriteEntity.modifyDate == null}">-</span>
                    <div class="history-details">
                        <ul th:each="favoriteHistoryEntityList, iterStat : ${favoriteEntity.favoriteHistoryEntityList}"
                            th:if="${iterStat.index} < 5">
                            <li th:text="${#temporals.format(favoriteHistoryEntityList.modifyDate, 'M/d')}">10/08</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div th:if="${favoriteList != null}">
        <nav th:if="${favoriteList.totalPages > 1}"
             th:with="blockSize=${10}, start=${(favoriteList.number / blockSize) * blockSize},
                  end=${T(java.lang.Math).min(favoriteList.totalPages - 1, start + blockSize - 1)}">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${favoriteList.number == 0} ? 'disabled'">
                    <a aria-label="Previous" class="page-link"
                       th:href="@{/favorite/list(page=${favoriteList.number - 1})}">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>

                <li class="page-item" th:if="${start > 0}">
                    <a class="page-link" th:href="@{/favorite/list(page=0)}">1</a>
                </li>
                <li class="page-item disabled" th:if="${start > 1}">
                    <span class="page-link">...</span>
                </li>

                <li class="page-item"
                    th:classappend="${i == favoriteList.number} ? 'active'"
                    th:each="i : ${#numbers.sequence(start, end)}">
                    <a class="page-link" th:href="@{/favorite/list(page=${i})}" th:text="${i + 1}"></a>
                </li>

                <li class="page-item disabled" th:if="${end < favoriteList.totalPages - 2}">
                    <span class="page-link">...</span>
                </li>
                <li class="page-item" th:if="${end < favoriteList.totalPages - 1}">
                    <a class="page-link" th:href="@{/favorite/list(page=${favoriteList.totalPages - 1})}"
                       th:text="${favoriteList.totalPages}"></a>
                </li>

                <li class="page-item"
                    th:classappend="${favoriteList.number == favoriteList.totalPages - 1} ? 'disabled'">
                    <a aria-label="Next" class="page-link" th:href="@{/favorite/list(page=${favoriteList.number + 1})}">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<div class="toast" id="toast" style="position: fixed; bottom: 20px; right: 20px; display: none;">
    <div class="toast-body">
        <span id="toast-text"></span>
    </div>
</div>

<div class="modal-backdrop" id="karma-modal">
    <div class="modal-panel">
        <div class="modal-header">
            <div class="modal-title">업보 적용</div>
            <button class="modal-close" id="karma-close" type="button">닫기</button>
        </div>
        <div>
            <div class="badge" id="karma-target"></div>
        </div>
        <div class="adjustment-list" id="adjustment-list"></div>
        <div class="calc-panel">
            <div class="calc-row"><span>현재 호감도</span><strong id="calc-current">0</strong></div>
            <div class="calc-row"><span>선택 합계</span><strong id="calc-delta">0</strong></div>
            <div class="calc-row"><span>적용 후</span><strong id="calc-after">0</strong></div>
        </div>
        <div class="modal-actions">
            <button class="btn-ghost" id="karma-clear" type="button">선택 초기화</button>
            <button class="btn-strong" id="karma-apply" type="button">수정 적용</button>
        </div>
    </div>
</div>

<div class="modal-backdrop" id="attendance-modal">
    <div class="modal-panel">
        <div class="modal-header">
            <div class="modal-title">출석체크</div>
            <button class="modal-close" id="attendance-close" type="button">닫기</button>
        </div>
        <div class="attendance-meta">
            <div class="attendance-field">
                <span>호감도 증가</span>
                <input id="attendance-amount" min="1" type="number" value="1">
            </div>
            <div class="attendance-status">
                <span id="attendance-count">0명 선택</span>
                <span id="attendance-total">0명 현재</span>
            </div>
        </div>
        <div class="attendance-list" id="attendance-list"></div>
        <div class="modal-actions">
            <button class="btn-ghost" id="attendance-cancel" type="button">닫기</button>
            <button class="btn-strong" id="attendance-apply" type="button">확인</button>
        </div>
    </div>
</div>

<div id="loading-spinner">
    <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="/js/favorite-list.js"></script>
</body>
</html>
